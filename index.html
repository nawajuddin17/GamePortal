<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spin & Slot Game</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    .screen { display: none; padding: 20px; }
    .active { display: block; }
    .header, .footer { background: #f8f8f8; padding: 10px; }
    .header button, .footer button { margin: 5px; padding: 5px 10px; }
    #game-result, #spin-result, #slot-result { margin: 20px; font-size: 1.2em; }
    #admin-panel table { margin: 0 auto; border-collapse: collapse; }
    #admin-panel th, #admin-panel td { border: 1px solid #ddd; padding: 8px; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .banner { background: #ffeaa7; padding: 10px; margin: 10px 0; }
    @media (max-width: 600px) { .header button, .footer button { display: block; width: 100%; } }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <button onclick="window.open('https://example.com/home', '_blank')">Home</button>
    <button onclick="window.open('https://example.com/contact', '_blank')">Contact</button>
    <button onclick="window.open('https://example.com/support', '_blank')">Support</button>
  </div>

  <!-- Login Screen -->
  <div id="login-screen" class="screen active">
    <h1>Login</h1>
    <input type="text" id="login-username" placeholder="Username or Email"><br>
    <input type="password" id="login-password" placeholder="Password"><br>
    <button onclick="login()">Login</button><br>
    <button onclick="showScreen('signup-screen')">Sign Up</button>
    <div class="banner">5% Extra credit on Deposit 200 Tk/more!!!</div>
  </div>

  <!-- Signup Screen -->
  <div id="signup-screen" class="screen">
    <h1>Sign Up</h1>
    <input type="text" id="signup-name" placeholder="Name"><br>
    <input type="email" id="signup-email" placeholder="Email"><br>
    <input type="text" id="signup-username" placeholder="Username"><br>
    <input type="password" id="signup-password" placeholder="Password (6-8 characters)"><br>
    <button onclick="signup()">Sign Up</button><br>
    <button onclick="showScreen('login-screen')">Back to Login</button>
    <div class="banner">5% Extra credit on Deposit 200 Tk/more!!!</div>
  </div>

  <!-- Main Screen -->
  <div id="main-screen" class="screen">
    <h1>Welcome!</h1>
    <p id="user-profile">Username: <span id="profile-username"></span> | Balance: <span id="profile-balance">0 Tk</span></p>
    <button onclick="deposit()">Deposit</button>
    <button onclick="showWithdrawForm()">Withdraw</button><br>
    <div id="withdraw-form" style="display:none; margin-top: 10px;">
      <select id="bank-name">
        <option value="bKash">bKash</option>
        <option value="Nagad">Nagad</option>
      </select><br>
      <input type="text" id="account-no" placeholder="Account Number"><br>
      <input type="number" id="withdraw-amount" placeholder="Amount"><br>
      <button onclick="submitWithdraw()">Submit</button>
    </div>
    <p>Min. Deposit: 100 Tk | Min. Withdrawal: 200 Tk</p>
    <button onclick="showScreen('spin-screen')">Spin Game</button>
    <button onclick="showScreen('slot-screen')">Slot Game</button>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Spin Screen -->
  <div id="spin-screen" class="screen">
    <h2>Spin the Wheel (15 Tk)</h2>
    <p>Balance: <span id="spin-balance">0 Tk</span></p>
    <button id="spin-button" onclick="playSpin()">Spin Now</button>
    <div id="spin-result"></div>
    <button onclick="showScreen('main-screen')">Back to Main</button>
  </div>

  <!-- Slot Screen -->
  <div id="slot-screen" class="screen">
    <h2>Slot Machine</h2>
    <p>Balance: <span id="slot-balance">0 Tk</span></p>
    <select id="slot-fee">
      <option value="10">10 Tk</option>
      <option value="20">20 Tk</option>
    </select>
    <button id="slot-button" onclick="playSlot()">Play Slot</button>
    <div id="slot-result"></div>
    <button onclick="showScreen('main-screen')">Back to Main</button>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="screen">
    <h2>Admin Control Panel</h2>
    <h3>System Wallet: <span id="system-wallet">0 Tk</span></h3>
    <h3>Users</h3>
    <table>
      <thead>
        <tr>
          <th>Username</th>
          <th>Balance</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="user-list"></tbody>
    </table>
    <h3>Withdrawal Requests</h3>
    <div id="withdrawal-requests"></div>
    <button onclick="showScreen('main-screen')">Back to Main</button>
  </div>

  <!-- Footer -->
  <div class="footer">
    <button onclick="window.open('https://example.com/terms', '_blank')">Terms & Conditions</button>
    <button onclick="window.open('https://example.com/privacy', '_blank')">Privacy & Policy</button><br>
    <button onclick="window.open('https://facebook.com', '_blank')">Facebook</button>
    <button onclick="window.open('https://instagram.com', '_blank')">Instagram</button>
    <button onclick="window.open('https://youtube.com', '_blank')">YouTube</button>
    <button onclick="window.open('https://linkedin.com', '_blank')">LinkedIn</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-functions.js"></script>

  <script>
    // Your Firebase configuration (replace with your own)
    const firebaseConfig = {
      apiKey: "AIzaSyAxudaL6GT0J-M3umxgnF2qiuvZm-gAlf0",
      authDomain: "gameportal-17.firebaseapp.com",
      projectId: "gameportal-17",
      storageBucket: "gameportal-17.firebasestorage.app",
      messagingSenderId: "440173722083",
      appId: "1:440173722083:web:86aa8de5e6d8855bfbc8d6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let currentUser = null;
    const SPIN_FEE = 15;
    const SLOT_FEES = [10, 20];

    function showScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
      document.getElementById(screenId).classList.add('active');
    }

    async function signup() {
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const username = document.getElementById('signup-username').value;
      const password = document.getElementById('signup-password').value;

      if (password.length < 6 || password.length > 8) {
        alert('Password must be 6-8 characters.');
        return;
      }

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        await db.collection('users').doc(user.uid).set({
          name,
          email,
          username,
          balance: 0,
          referralCode: Math.random().toString(36).substring(2, 8).toUpperCase(),
          isAdmin: false
        });
        alert('Signup successful! Please login.');
        showScreen('login-screen');
      } catch (error) {
        alert(error.message);
      }
    }

    async function login() {
      const usernameOrEmail = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;

      try {
        let email = usernameOrEmail;
        if (!email.includes('@')) {
          const userDoc = await db.collection('users').where('username', '==', email).get();
          if (!userDoc.empty) email = userDoc.docs[0].data().email;
        }
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        const userDoc = await db.collection('users').doc(currentUser.uid).get();
        if (userDoc.data().isAdmin) {
          showScreen('admin-panel');
          loadAdminPanel();
        } else {
          showScreen('main-screen');
          updateProfile();
          updateGameButtons();
        }
      } catch (error) {
        alert(error.message);
      }
    }

    function logout() {
      auth.signOut();
      currentUser = null;
      showScreen('login-screen');
    }

    function updateProfile() {
      db.collection('users').doc(currentUser.uid).onSnapshot(doc => {
        const data = doc.data();
        document.getElementById('profile-username').innerText = data.username;
        document.getElementById('profile-balance').innerText = `${data.balance} Tk`;
        document.getElementById('spin-balance').innerText = `${data.balance} Tk`;
        document.getElementById('slot-balance').innerText = `${data.balance} Tk`;
        updateGameButtons(data.balance);
      });
    }

    function updateGameButtons(balance) {
      document.getElementById('spin-button').disabled = balance < SPIN_FEE;
      document.getElementById('slot-button').disabled = balance < SLOT_FEES[0];
    }

    function deposit() {
      window.open('https://example.com/deposit', '_blank');
    }

    function showWithdrawForm() {
      document.getElementById('withdraw-form').style.display = 'block';
    }

    async function submitWithdraw() {
      const bank = document.getElementById('bank-name').value;
      const accountNo = document.getElementById('account-no').value;
      const amount = parseInt(document.getElementById('withdraw-amount').value);

      if (amount < 200) {
        alert('Minimum withdrawal is 200 Tk.');
        return;
      }

      const userDoc = await db.collection('users').doc(currentUser.uid).get();
      if (userDoc.data().balance < amount) {
        alert('Insufficient balance.');
        return;
      }

      await db.collection('withdrawals').add({
        userId: currentUser.uid,
        bank,
        accountNo,
        amount,
        status: 'pending',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      alert('Withdrawal request submitted.');
      document.getElementById('withdraw-form').style.display = 'none';
    }

    async function playSpin() {
      const userDoc = await db.collection('users').doc(currentUser.uid).get();
      const balance = userDoc.data().balance;
      if (balance < SPIN_FEE) return;

      document.getElementById('spin-result').innerText = 'Spinning...';
      await animateGame(5000);
      const rewards = [2, 3, 5, 7, 9, 11, 13, 15, 50, 100, '1 FS', '2 FS'];
      const reward = rewards[Math.floor(Math.random() * rewards.length)];

      await db.collection('users').doc(currentUser.uid).update({
        balance: firebase.firestore.FieldValue.increment(-SPIN_FEE + (typeof reward === 'number' ? reward : 0))
      });
      await db.collection('system').doc('wallet').update({
        balance: firebase.firestore.FieldValue.increment(SPIN_FEE - (typeof reward === 'number' ? reward : 0))
      });
      document.getElementById('spin-result').innerText = `You won: ${reward}!`;
    }

    async function playSlot() {
      const fee = parseInt(document.getElementById('slot-fee').value);
      const userDoc = await db.collection('users').doc(currentUser.uid).get();
      const balance = userDoc.data().balance;
      if (balance < fee) return;

      document.getElementById('slot-result').innerText = 'Slot running...';
      await animateGame(5000);
      const reward = calculateSlotReward(fee);

      await db.collection('users').doc(currentUser.uid).update({
        balance: firebase.firestore.FieldValue.increment(-fee + reward)
      });
      await db.collection('system').doc('wallet').update({
        balance: firebase.firestore.FieldValue.increment(fee - reward)
      });
      document.getElementById('slot-result').innerText = `You won: ${reward} Tk!`;
    }

    function calculateSlotReward(fee) {
      const rand = Math.random();
      if (fee === 10) {
        if (rand < 0.2) return 3;  // 1 match in 1 row
        if (rand < 0.4) return 5;  // 2 different in 2 rows
        if (rand < 0.6) return 7;  // 3 different in 3 rows
        if (rand < 0.8) return 15; // 1 match in 2 rows
        return 25;                 // 1 match in 3 rows
      } else {
        if (rand < 0.2) return 5;  // 1 match in 1 row
        if (rand < 0.4) return 10; // 2 different in 2 rows
        if (rand < 0.6) return 15; // 3 different in 3 rows
        if (rand < 0.8) return 25; // 1 match in 2 rows
        return 50;                 // 1 match in 3 rows
      }
    }

    function animateGame(duration) {
      return new Promise(resolve => {
        let start = Date.now();
        function step() {
          let elapsed = Date.now() - start;
          if (elapsed < duration) requestAnimationFrame(step);
          else resolve();
        }
        requestAnimationFrame(step);
      });
    }

    async function loadAdminPanel() {
      const systemDoc = await db.collection('system').doc('wallet').get();
      document.getElementById('system-wallet').innerText = `${systemDoc.data().balance} Tk`;

      db.collection('users').onSnapshot(snapshot => {
        const userList = document.getElementById('user-list');
        userList.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          if (!data.isAdmin) {
            const row = `<tr>
              <td>${data.username}</td>
              <td>${data.balance} Tk</td>
              <td><button onclick="editBalance('${doc.id}', ${data.balance})">Edit</button></td>
            </tr>`;
            userList.innerHTML += row;
          }
        });
      });

      db.collection('withdrawals').onSnapshot(snapshot => {
        const requests = document.getElementById('withdrawal-requests');
        requests.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          if (data.status === 'pending') {
            const div = `<div>
              User: ${data.userId} | Amount: ${data.amount} Tk | 
              <button onclick="approveWithdrawal('${doc.id}', ${data.amount}, '${data.userId}')">Approve</button>
              <button onclick="declineWithdrawal('${doc.id}')">Decline</button>
            </div>`;
            requests.innerHTML += div;
          }
        });
      });
    }

    async function editBalance(userId, currentBalance) {
      const newBalance = parseInt(prompt('Enter new balance:', currentBalance));
      if (newBalance >= 0) {
        await db.collection('users').doc(userId).update({ balance: newBalance });
        const diff = newBalance - currentBalance;
        await db.collection('system').doc('wallet').update({
          balance: firebase.firestore.FieldValue.increment(-diff)
        });
      }
    }

    async function approveWithdrawal(withdrawalId, amount, userId) {
      await db.collection('withdrawals').doc(withdrawalId).update({ status: 'approved' });
      await db.collection('users').doc(userId).update({
        balance: firebase.firestore.FieldValue.increment(-amount)
      });
    }

    async function declineWithdrawal(withdrawalId) {
      await db.collection('withdrawals').doc(withdrawalId).update({ status: 'declined' });
    }

    // Initialize system wallet if not exists
    db.collection('system').doc('wallet').get().then(doc => {
      if (!doc.exists) {
        db.collection('system').doc('wallet').set({ balance: 0 });
      }
    });
  </script>
</body>
</html>
